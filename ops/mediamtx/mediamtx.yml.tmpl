###############################################
# MediaMTX configuration for Atlas Edge Node
# Managed from Atlas-pi5plus source of truth
###############################################

# --- Global settings ---
logLevel: info
logDestinations: [stdout]

readTimeout: 10s
writeTimeout: 10s
writeQueueSize: 512

# --- Authentication ---
authMethod: internal
authInternalUsers:
  # Local node services only (publisher + local control API)
  - user: any
    pass:
    ips: ['127.0.0.1', '::1']
    permissions:
      - action: publish
        path: cam1
      - action: api
      - action: metrics
      - action: pprof

  # Dashboard reader credentials for remote WebRTC/HLS clients
  - user: ${MEDIAMTX_READ_USER}
    pass: ${MEDIAMTX_READ_PASS}
    permissions:
      - action: read
        path: cam1

# --- API (for health checks) ---
api: yes
apiAddress: 127.0.0.1:9997

# --- RTSP server ---
rtsp: yes
rtspAddress: 127.0.0.1:8554
rtspTransports: [tcp, udp]

# --- WebRTC server ---
webrtc: yes
webrtcAddress: :8889
webrtcLocalUDPAddress: :8189
webrtcICEServers2: []

# --- HLS server ---
hls: yes
hlsAddress: 127.0.0.1:8888
hlsAlwaysRemux: no
hlsSegmentCount: 7
hlsSegmentDuration: 1s
hlsPartDuration: 200ms
hlsSegmentMaxSize: 50M
hlsAllowOrigins: ['*']

# --- Path defaults ---
pathDefaults:
  record: yes
  recordPath: /recordings/%path/%Y-%m-%d_%H-%M-%S
  recordFormat: fmp4
  recordSegmentDuration: 5m
  recordDeleteAfter: ${MEDIAMTX_RECORD_DELETE_AFTER}

# --- Paths ---
paths:
  cam1:
    source: publisher
